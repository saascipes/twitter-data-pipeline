{"jobDefs":[{"version":"0.0","name":"Tweet Stream Analyzer","maxInstances":1,"coalesce":true,"pauseOnJobFail":false,"runtimeVars":{"s3Bucket":"*","oldTweetsCutoffMS":"*","rmqPassword":"*","rmqUser":"*","rmqUrl":"*","localFilePath":"*","TIMEOUT":"*","TWITTER_BEARER_TOKEN":"*","TWEETS_UPLOAD_PREFIX":"*","TWEETS_UPLOAD_BUCKET":"*","MAX_TWEETS":"*"},"schedules":[],"taskDefs":[{"target":32,"name":"Stream tweets","requiredTags":{},"fromRoutes":[],"toRoutes":[],"autoRestart":false,"stepDefs":[{"name":"AwsLambda","order":1,"command":"","arguments":"","variables":{},"lambdaCodeSource":"script","lambdaRuntime":"nodejs10.x","lambdaMemorySize":128,"lambdaTimeout":40,"lambdaFunctionHandler":"","lambdaAWSRegion":"","lambdaDependencies":"aws-sdk;request;moment","lambdaZipfile":"","scriptName":"StreamTweetsToS3.js"}],"exportWarnings":[]},{"target":4,"name":"Analyze tweets","requiredTags":{"role":"spark-master"},"fromRoutes":[["Stream tweets",""]],"toRoutes":[],"autoRestart":false,"stepDefs":[{"name":"download tweet file","order":2,"command":"","arguments":"","variables":{"AWS_ACCESS_KEY_ID":"missing","AWS_SECRET_ACCESS_KEY":"missing"},"lambdaCodeSource":"script","lambdaRuntime":"","lambdaMemorySize":128,"lambdaTimeout":3,"lambdaFunctionHandler":"","lambdaAWSRegion":"","lambdaDependencies":"","lambdaZipfile":"","scriptName":"DownloadS3File.sh"},{"name":"run tweet analysis","order":3,"command":"","arguments":"","variables":{},"lambdaCodeSource":"script","lambdaRuntime":"","lambdaMemorySize":128,"lambdaTimeout":3,"lambdaFunctionHandler":"","lambdaAWSRegion":"","lambdaDependencies":"","lambdaZipfile":"","scriptName":"run-word-count-scala.sh"},{"name":"publish topics","order":4,"command":"","arguments":"","variables":{},"lambdaCodeSource":"script","lambdaRuntime":"","lambdaMemorySize":128,"lambdaTimeout":3,"lambdaFunctionHandler":"","lambdaAWSRegion":"","lambdaDependencies":"","lambdaZipfile":"","scriptName":"PublishTwitterTopics.py"},{"name":"delete old tweets","order":1,"command":"","arguments":"","variables":{},"lambdaCodeSource":"script","lambdaRuntime":"","lambdaMemorySize":128,"lambdaTimeout":3,"lambdaFunctionHandler":"","lambdaAWSRegion":"","lambdaDependencies":"","lambdaZipfile":"","scriptName":"TweetStreamAnalyzer_DeleteOldTweets.js"}],"exportWarnings":[]}]}],"scripts":[{"name":"StreamTweetsToS3.js","scriptType":1,"code":"QHNncygiUzNBY2Nlc3MuanMiKQo7Cgpjb25zdCByZXF1ZXN0ID0gcmVxdWlyZSgicmVxdWVzdCIpOwpjb25zdCBtb21lbnQgPSByZXF1aXJlKCJtb21lbnQiKTsKY29uc3QgZnMgPSByZXF1aXJlKCdmcycpOwoKY29uc3QgQkVBUkVSX1RPS0VOID0gIkBzZ2coIlRXSVRURVJfQkVBUkVSX1RPS0VOIikiOwpjb25zdCBNQVhfVFdFRVRTID0gQHNnZygiTUFYX1RXRUVUUyIpOwoKbGV0IHRpbWVvdXQgPSAwOwpsZXQgZmluaXNoZWQgPSBmYWxzZTsKbGV0IGNodW5rcyA9IFtdOwoKY29uc3Qgc3RyZWFtVVJMID0gbmV3IFVSTCgKICAiaHR0cHM6Ly9hcGkudHdpdHRlci5jb20vMi90d2VldHMvc2VhcmNoL3N0cmVhbT90d2VldC5maWVsZHM9Y29udGV4dF9hbm5vdGF0aW9ucyZleHBhbnNpb25zPWF1dGhvcl9pZCIKKTsKCmNvbnN0IHNsZWVwID0gYXN5bmMgKGRlbGF5KSA9PiB7CiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiBzZXRUaW1lb3V0KCgpID0+IHJlc29sdmUodHJ1ZSksIGRlbGF5KSk7Cn07Cgpjb25zdCBzdHJlYW1Ud2VldHMgPSAoKSA9PiB7CiAgY29uc3QgdG9rZW4gPSBCRUFSRVJfVE9LRU47CgogIGxldCBmaWxlTmFtZSA9IGB0d2VldHNfJHttb21lbnQudXRjKCkuZm9ybWF0KCdZWVlZTU1EREhIbW1zc1NTUycpfS50eHRgOwogIGxldCBsb2NhbEZpbGVQYXRoID0gYC90bXAvJHtmaWxlTmFtZX1gOwogIGxldCBmZCA9IGZzLm9wZW5TeW5jKGxvY2FsRmlsZVBhdGgsICdhKycpOwogIGxldCBwb3NpdGlvbiA9IDA7CgogIGNvbnN0IGNvbmZpZyA9IHsKICAgIHVybDogc3RyZWFtVVJMLAogICAgYXV0aDogewogICAgICBiZWFyZXI6IHRva2VuLAogICAgfSwKICAgIHRpbWVvdXQ6IDMxMDAwLAogIH07CgogIHRyeSB7CiAgICBjb25zdCBzdHJlYW0gPSByZXF1ZXN0LmdldChjb25maWcpOwogICAgY29uc29sZS5sb2coJ3N0YXJ0aW5nIHN0cmVhbScpOwogICAgbGV0IHR3ZWV0Q291bnQgPSAwOwogICAgc3RyZWFtCiAgICAgIC5vbigiZGF0YSIsIGFzeW5jIChkYXRhKSA9PiB7CiAgICAgICAgY2h1bmtzLnB1c2goZGF0YSk7CiAgICAgICAgLy8gY29uc29sZS5sb2coJ3JlY2VpdmVkIHR3ZWV0IGNvdW50IC0+ICcsIGNodW5rcy5sZW5ndGgpOwogICAgICAgIHR3ZWV0Q291bnQrKzsKICAgICAgICBpZiAodHdlZXRDb3VudCA+PSBNQVhfVFdFRVRTKSB7CiAgICAgICAgICBzdHJlYW0uYWJvcnQoKTsKICAgICAgICB9CiAgICAgIH0pCiAgICAgIC5vbignZW5kJywgYXN5bmMgKCkgPT4gewogICAgICAgIGNvbnNvbGUubG9nKCdlbmQgc3RyZWFtJyk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGxldCB0d2VldENvdW50ID0gMDsKICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2h1bmtzLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgIGlmIChjaHVua3NbaV0udG9TdHJpbmcoKSA9PT0gJ1xyXG4nKQogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB0d2VldENvdW50Kys7CiAgICAgICAgICAgIGNvbnN0IGpzb24gPSBKU09OLnBhcnNlKGNodW5rc1tpXSk7CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdqc29uIC0+ICcsIGpzb24pOwogICAgICAgICAgICBpZiAoanNvbi5kYXRhKSB7CiAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ2RhdGEgLT4gJywganNvbi5kYXRhKTsKICAgICAgICAgICAgICBjb25zdCBudW1CeXRlc1dyaXR0ZW4gPSBmcy53cml0ZVN5bmMoZmQsIGpzb24uZGF0YS50ZXh0ICsgJ1xuJywgcG9zaXRpb24sICd1dGY4Jyk7CiAgICAgICAgICAgICAgcG9zaXRpb24gKz0gbnVtQnl0ZXNXcml0dGVuOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoImF1dGhFcnJvciIsIGpzb24pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgZnMuY2xvc2VTeW5jKGZkKTsKICAgICAgICAgIGxldCBzM0ZpbGVQYXRoID0gJ3R3ZWV0LXN0cmVhbWVyLycgKyBmaWxlTmFtZTsKICAgICAgICAgIGxldCBzM0Z1bGxGaWxlUGF0aCA9IGBzMzovL3NnLWZpbGVzLXNoYXJlLyR7czNGaWxlUGF0aH1gOwogICAgICAgICAgY29uc29sZS5sb2coYEBzZ297InMzRmlsZVBhdGgiOiAiJHtzM0Z1bGxGaWxlUGF0aH0ifWApOwogICAgICAgICAgY29uc29sZS5sb2coYEBzZ297ImZpbGVOYW1lIjogIiR7ZmlsZU5hbWV9In1gKTsKICAgICAgICAgIGNvbnN0IGRhdGEgPSBmcy5yZWFkRmlsZVN5bmMobG9jYWxGaWxlUGF0aCk7CiAgICAgICAgICBhd2FpdCBVcGxvYWRUb1MzKCdAc2dnKCJzM0J1Y2tldCIpJywgczNGaWxlUGF0aCwgZGF0YSk7CiAgICAgICAgICBhd2FpdCBzbGVlcCgyKTsKICAgICAgICAgIGNvbnNvbGUubG9nKGBTYXZlZCAke3R3ZWV0Q291bnR9IHR3ZWV0cyB0byAke3MzRnVsbEZpbGVQYXRofWApOwogICAgICAgICAgaWYgKHR3ZWV0Q291bnQgPiAwKQogICAgICAgICAgICBjb25zb2xlLmxvZyhgQHNnb3sicm91dGUiOiAib2sifWApOwogICAgICAgICAgZWxzZQogICAgICAgICAgICBjb25zb2xlLmxvZyhgQHNnb3sicm91dGUiOiAibm8tdHdlZXRzIn1gKTsKICAgICAgICAgIGZpbmlzaGVkID0gdHJ1ZTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBzYXZpbmcgdHdlZXRzOiAnLCBlKTsKICAgICAgICAgIGZpbmlzaGVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0pCiAgICAgIC5vbigiZXJyb3IiLCAoZXJyb3IpID0+IHsKICAgICAgICAvLyBDb25uZWN0aW9uIHRpbWVkIG91dAogICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yOiAiLCBlcnJvci5tZXNzYWdlKTsKICAgICAgICByZWNvbm5lY3Qoc3RyZWFtKTsKICAgICAgfSk7CiAgICAgIHJldHVybiBzdHJlYW07CiAgfSBjYXRjaCAoZSkgewogICAgY29uc29sZS5lcnJvcigiYXV0aEVycm9yIiwgZS5tZXNzYWdlKTsKICAgIGZpbmlzaGVkID0gdHJ1ZTsKICB9Cn07Cgpjb25zdCByZWNvbm5lY3QgPSBhc3luYyAoc3RyZWFtKSA9PiB7CiAgdGltZW91dCsrOwogIHN0cmVhbS5hYm9ydCgpOwogIGF3YWl0IHNsZWVwKDIgKiogdGltZW91dCAqIDEwMDApOwogIHN0cmVhbVR3ZWV0cygpOwp9OwoKKGFzeW5jICgpID0+IHsKICBsZXQgc3RyZWFtID0gYXdhaXQgc3RyZWFtVHdlZXRzKCk7CiAgY29uc29sZS5sb2coJ3N0cmVhbSBjcmVhdGVkJyk7CiAgY29uc3QgdGltZW91dCA9IEBzZ2coVElNRU9VVCk7CiAgY29uc3Qgc3RhcnQgPSBuZXcgRGF0ZSgpOwogIGxldCBzdHJlYW1BYm9ydGVkID0gZmFsc2U7CiAgd2hpbGUodHJ1ZSl7CiAgICAvLyBjb25zb2xlLmxvZygnc2xlZXBpbmcnKTsKICAgIGF3YWl0IHNsZWVwKDIwMDApOwogICAgaWYgKGZpbmlzaGVkKXsKICAgICAgY29uc29sZS5sb2coJ2ZpbmlzaGVkIC0gZXhpdGluZycpOwogICAgICBwcm9jZXNzLmV4aXQoKTsKICAgIH0KICAgIGlmICghc3RyZWFtQWJvcnRlZCAmJiAobmV3IERhdGUoKSkgLSBzdGFydCA+IHRpbWVvdXQpIHsKICAgICAgY29uc29sZS5sb2coJ3RpbWVkIG91dCAtIGFib3J0aW5nIHN0cmVhbScpOwogICAgICBzdHJlYW0uYWJvcnQoKTsKICAgICAgc3RyZWFtQWJvcnRlZCA9IHRydWU7CiAgICB9CiAgfQp9KSgpOwo=","teamUsable":true,"teamEditable":false,"isActive":true},{"name":"DownloadS3File.sh","scriptType":2,"code":"aWYgWyAiQHNnZygibG9jYWxGaWxlUGF0aCIpIiAhPSAibnVsbCIgXQp0aGVuCiAgICBMT0NBTF9GSUxFX1BBVEg9IkBzZ2coImxvY2FsRmlsZVBhdGgiKSIKZWxzZQogICAgTE9DQUxfRklMRV9QQVRIPSIuIgpmaQoKYXdzIHMzIGNwIEBzZ2coInMzRmlsZVBhdGgiKSAke0xPQ0FMX0ZJTEVfUEFUSH0=","teamUsable":true,"teamEditable":false,"isActive":true},{"name":"run-word-count-scala.sh","scriptType":2,"code":"L3NwYXJrL2Jpbi9zcGFyay1zdWJtaXQgLS1jbGFzcyAiTERBTGVtbWEiIC0tbWFzdGVyIGxvY2FsWypdIC9vcHQvc3BhcmstYXBwcy9sZGEtbWVkaXVtLWFzc2VtYmx5LTEuMC5qYXIgLS1zdG9wd29yZEZpbGUgL29wdC9zcGFyay1kYXRhL3N0b3BXZHMudHh0ICAtLXZvY2FiU2l6ZSAzMDAwIC0tbWluREYgMiAtLW1heERGIDAuOCAtLWsgNSAtLWRvY0NvbmNlbnRyYXRpb24gMC4xIC0tdG9waWNDb25jZW50cmF0aW9uIDAuMDMgLS1hbGdvcml0aG0gIm9ubGluZSIgLS1wcmV0cmFpbmVkRm9sZGVyICIvb3B0L3NwYXJrLWRhdGEvbmVyX3ByZXRyYWluZWRfZm9sZGVyLyIgIi9vcHQvc3BhcmstZGF0YS90d2VldHMvIiA+IHRtcC5vdXQgMj4mMQoKcmVzPSQoY2F0IHJlc3VsdHMudHh0KQoKZWNobyAiQHNnb3tcInRvcGljc1wiOiBcIiRyZXNcIn0i","teamUsable":true,"teamEditable":false,"isActive":true},{"name":"PublishTwitterTopics.py","scriptType":0,"code":"IyBjb2Rpbmc9dXRmLTgKCmltcG9ydCB0aW1lCmltcG9ydCBqc29uCmltcG9ydCBwaWthCgoKZGVmIHB1Ymxpc2hfbWVzc2FnZSh1cmwsIGV4Y2gsIHJvdXRpbmdfa2V5LCBtc2cpOgogICAgbXNnX2pzb24gPSBqc29uLmR1bXBzKG1zZykKICAgIGNvbm4gPSBwaWthLkJsb2NraW5nQ29ubmVjdGlvbihwaWthLlVSTFBhcmFtZXRlcnModXJsKSkKICAgIGNoYW5uZWwgPSBjb25uLmNoYW5uZWwoKQogICAgY2hhbm5lbC5leGNoYW5nZV9kZWNsYXJlKGV4Y2hhbmdlPWV4Y2gsIGV4Y2hhbmdlX3R5cGU9J3RvcGljJywgZHVyYWJsZT1UcnVlKQogICAgcmVzID0gY2hhbm5lbC5iYXNpY19wdWJsaXNoKGV4Y2hhbmdlPWV4Y2gsIHJvdXRpbmdfa2V5PXJvdXRpbmdfa2V5LCBib2R5PW1zZ19qc29uLCBwcm9wZXJ0aWVzPXBpa2EuQmFzaWNQcm9wZXJ0aWVzKGRlbGl2ZXJ5X21vZGU9MikpCgp1cmwgPSAnYW1xcDovL0BzZ2cocm1xVXNlcik6QHNnZyhybXFQYXNzd29yZClAQHNnZyhybXFVcmwpL3R3aXR0ZXJEYXRhUGlwZWxpbmUnCgp0b3BpY0dyb3VwcyA9IGZpbHRlcihOb25lLCAnQHNnZyh0b3BpY3MpJy5zcGxpdCgnOycpKQppbmRleCA9IDAKZm9yIHRvcGljR3JvdXAgaW4gdG9waWNHcm91cHM6CiAgICBwcmludCgndG9waWNHcm91cCAtPiAnLCB0b3BpY0dyb3VwLnNwbGl0KCc6JylbMF0pCiAgICB0b3BpY190ZXh0ID0gJycKICAgIHRvcGljcyA9IGZpbHRlcihOb25lLCB0b3BpY0dyb3VwLnNwbGl0KCc6JylbMV0uc3BsaXQoJ3wnKSkKICAgIGZvciB0b3BpYyBpbiB0b3BpY3M6CiAgICAgICAgdG9waWNfdGV4dCArPSAodG9waWMuc3BsaXQoJz0nKVswXSArICcgKCcgKyB0b3BpYy5zcGxpdCgnPScpWzFdWzA6Nl0gKyAnKSwgJykKICAgIHRvcGljX2luZm8gPSB7ImlkIjogc3RyKGluZGV4KSwgInRleHQiOiB0b3BpY190ZXh0fQogICAgbXNnID0geyJkb21haW5UeXBlIjogInRvcGljIiwgIm9wZXJhdGlvbiI6IDIsICJtb2RlbCI6IHRvcGljX2luZm8sICJjb3JyZWxhdGlvbklkIjogMCB9CiAgICBwdWJsaXNoX21lc3NhZ2UodXJsLCAndHdpdHRlci1kYXRhLXBpcGVsaW5lJywgJ2JwJywgbXNnKQogICAgaW5kZXggKz0gMQ==","teamUsable":true,"teamEditable":false,"isActive":true},{"name":"TweetStreamAnalyzer_DeleteOldTweets.js","scriptType":1,"code":"Y29uc3QgZnMgPSByZXF1aXJlKCJmcyIpOwoKCmNvbnN0IHR3ZWV0c1BhdGggPSAnQHNnZygibG9jYWxGaWxlUGF0aCIpJwoKCmlmICghZnMuZXhpc3RzU3luYyh0d2VldHNQYXRoKSkKICAgIGZzLm1rZGlyU3luYyh0d2VldHNQYXRoKTsKCmxldCBkZWxldGVBbGxFeGlzdGluZ1R3ZWV0cyA9IGZhbHNlOwppZiAoJ0BzZ2coImRlbGV0ZUFsbEV4aXN0aW5nVHdlZXRzIiknID09ICd0cnVlJykKICAgIGRlbGV0ZUFsbEV4aXN0aW5nVHdlZXRzID0gdHJ1ZTsKCmxldCBvbGRUd2VldHNDdXRvZmZNUyA9IEBzZ2coIm9sZFR3ZWV0c0N1dG9mZk1TIik7CgpsZXQgUHJ1bmVUd2VldEZpbGVzID0gYXN5bmMgKCkgPT4gewogICAgcmV0dXJuIG5ldyBQcm9taXNlKCAocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgICAgZnMucmVhZGRpcih0d2VldHNQYXRoLCBhc3luYyAoZXJyLCBmaWxlcykgPT4gewogICAgICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgRXJyb3IgZ2V0dGluZyBjb250ZW50cyBvZiBmb2xkZXIgIiR7dHdlZXRzUGF0aH0iOiAke2Vycn1gKQogICAgICAgICAgICAgICAgcHJvY2Vzcy5leGl0KDEpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25zdCBjdXJyZW50RGF0ZSA9IERhdGUubm93KCk7CiAgICAgICAgICAgIGxldCBmaWxlc1RvRGVsZXRlID0gW107CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZmlsZXMubGVuZ3RoOyArK2kpewogICAgICAgICAgICAgICAgY29uc3QgZiA9IGZpbGVzW2ldOwogICAgICAgICAgICAgICAgaWYgKGRlbGV0ZUFsbEV4aXN0aW5nVHdlZXRzKXsKICAgICAgICAgICAgICAgICAgICBmaWxlc1RvRGVsZXRlLnB1c2goZik7CiAgICAgICAgICAgICAgICB9IGVsc2V7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0ZVN0ciA9IGYuc3BsaXQoJ18nKVsxXTsKICAgICAgICAgICAgICAgICAgICBjb25zdCB5ZWFyID0gcGFyc2VJbnQoZGF0ZVN0ci5zdWJzdHIoMCwgNCkpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IG1vbnRoID0gcGFyc2VJbnQoZGF0ZVN0ci5zdWJzdHIoNCwgMikpIC0gMTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXkgPSBwYXJzZUludChkYXRlU3RyLnN1YnN0cig2LCAyKSk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaG91ciA9IHBhcnNlSW50KGRhdGVTdHIuc3Vic3RyKDgsIDIpKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBtaW51dGUgPSBwYXJzZUludChkYXRlU3RyLnN1YnN0cigxMCwgMikpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlY29uZCA9IHBhcnNlSW50KGRhdGVTdHIuc3Vic3RyKDEyLCAyKSk7CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpbGVEYXRlID0gbmV3IERhdGUoRGF0ZS5VVEMoeWVhciwgbW9udGgsIGRheSwgaG91ciwgbWludXRlLCBzZWNvbmQpKTsKICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudERhdGUgLSBmaWxlRGF0ZSA+IG9sZFR3ZWV0c0N1dG9mZk1TKXsKICAgICAgICAgICAgICAgICAgICAgICAgZmlsZXNUb0RlbGV0ZS5wdXNoKGYpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBmaWxlc1RvRGVsZXRlLmxlbmd0aDsgKytpKXsKICAgICAgICAgICAgICAgIGNvbnN0IGZpbGVQYXRoID0gdHdlZXRzUGF0aCArIGZpbGVzVG9EZWxldGVbaV07CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgRGVsZXRpbmcgb2xkIHR3ZWV0IGZpbGUgIiR7ZmlsZVBhdGh9ImApOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBmcy51bmxpbmtTeW5jKGZpbGVQYXRoKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2goZXJyKXt9CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXNvbHZlKCk7CiAgICB9KTsKfQoKKGFzeW5jICgpID0+IHsKICAgIGF3YWl0IFBydW5lVHdlZXRGaWxlcygpOwp9KSgpOw==","teamUsable":true,"teamEditable":false,"isActive":true},{"name":"S3Access.js","scriptType":1,"code":"Ly8gTG9hZCB0aGUgU0RLIGZvciBKYXZhU2NyaXB0CnZhciBBV1MgPSByZXF1aXJlKCdhd3Mtc2RrJyk7Ci8vIFNldCB0aGUgUmVnaW9uIApBV1MuY29uZmlnLnVwZGF0ZSh7cmVnaW9uOiAndXMtZWFzdC0yJywgYWNjZXNzS2V5SWQ6J0BzZ2coIkFXU19BQ0NFU1NfS0VZX0lEIiknLCBzZWNyZXRBY2Nlc3NLZXk6J0BzZ2coIkFXU19TRUNSRVRfQUNDRVNTX0tFWSIpJ30pOwoKLy8gQ3JlYXRlIFMzIHNlcnZpY2Ugb2JqZWN0CnMzID0gbmV3IEFXUy5TMyh7YXBpVmVyc2lvbjogJzIwMDYtMDMtMDEnfSk7CgoKbGV0IFVwbG9hZFRvUzMgPSBhc3luYyAoYnVja2V0LCBrZXksIGRhdGEpID0+IHsKICBjb25zdCBwYXJhbXMgPSB7CiAgICAgIEJ1Y2tldDogYnVja2V0LAogICAgICBLZXk6IGtleSwKICAgICAgQm9keTogZGF0YQogIH07CgogIHJldHVybiBuZXcgUHJvbWlzZShhc3luYyAocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICBzMy51cGxvYWQocGFyYW1zLCAoZXJyLCBkYXRhKSA9PiB7CiAgICAgIGlmKGVycikgewogICAgICAgIHJlamVjdChlcnIpOwogICAgICB9IGVsc2UgewogICAgICAgIHJlc29sdmUoZGF0YSk7CiAgICAgIH0KICAgIH0pOwogIH0pOwp9OwoKCgpsZXQgTGlzdEZpbGVzID0gYXN5bmMgKGJ1Y2tldCwgcHJlZml4LCBsaXN0ID0gW10pID0+IHsKICBjb25zdCBwYXJhbXMgPSB7CiAgICAgIEJ1Y2tldDogYnVja2V0LAogICAgICBQcmVmaXg6IHByZWZpeCwKICAgICAgTWF4S2V5czogNTAKICB9OwoKICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICBzMy5saXN0T2JqZWN0c1YyKHBhcmFtcywgYXN5bmMgKGVyciwgZGF0YSkgPT4gewogICAgICAgICAgaWYgKGVycikgewogICAgICAgICAgICAgIHJlamVjdChlcnIpOwogICAgICAgICAgfQogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkoZGF0YSwgbnVsbCwgNCkpOwogICAgICAgICAgICAgIGlmIChkYXRhLkNvbnRlbnRzICYmIGRhdGEuQ29udGVudHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRhdGEuQ29udGVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBsaXN0LnB1c2goYHMzOi8vJHtidWNrZXR9LyR7ZGF0YS5Db250ZW50c1tpXS5LZXl9YCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKGRhdGEuSXNUcnVuY2F0ZWQpIHsKICAgICAgICAgICAgICAgICAgbGlzdCA9IGF3YWl0IGxpc3RGaWxlcyhwcmVmaXgsIGJ1Y2tldCwgbGlzdCwgZGF0YS5OZXh0Q29udGludWF0aW9uVG9rZW4pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXNvbHZlKGxpc3QpOwogICAgICAgICAgfQogICAgICB9KTsKICB9KTsKfTsK","teamUsable":true,"teamEditable":false,"isActive":true}]}